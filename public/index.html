<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STATIFY: IPL Stats Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/"><i class="fas fa-chart-line"></i> STATIFY</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/leaderboards">Leaderboards</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/matches">Matches</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/tickets">ðŸŽ« Tickets</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/add-player">Add Player</a>
                    </li>
                </ul>
                <a class="btn btn-warning btn-sm fw-bold" href="/login">Admin Login</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: white; padding: 3rem 0; text-align: center;">
        <div class="container">
            <h1 style="font-size: 3rem; font-weight: 800; margin-bottom: 1rem;">
                <i class="fas fa-cricket"></i> IPL Player Statistics
            </h1>
            <p style="font-size: 1.2rem; opacity: 0.9;">Track and explore the best cricket statistics from the Indian Premier League</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-5">
        <!-- Top Stats Overview -->
        <div class="row mb-5">
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body" style="background: linear-gradient(135deg, rgba(26,26,46,0.05) 0%, rgba(243,156,18,0.05) 100%);">
                        <i class="fas fa-fire" style="font-size: 2rem; color: var(--accent-color);"></i>
                        <h5 class="mt-3" style="color: var(--text-dark);">Most Runs</h5>
                        <p id="topRunsPlayer" class="mb-0"><span class="spinner"></span></p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body" style="background: linear-gradient(135deg, rgba(26,26,46,0.05) 0%, rgba(243,156,18,0.05) 100%);">
                        <i class="fas fa-bowling-ball" style="font-size: 2rem; color: var(--success-color);"></i>
                        <h5 class="mt-3" style="color: var(--text-dark);">Most Wickets</h5>
                        <p id="topWicketsPlayer" class="mb-0"><span class="spinner"></span></p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body" style="background: linear-gradient(135deg, rgba(26,26,46,0.05) 0%, rgba(243,156,18,0.05) 100%);">
                        <i class="fas fa-star" style="font-size: 2rem; color: #3498db;"></i>
                        <h5 class="mt-3" style="color: var(--text-dark);">Most Sixes</h5>
                        <p id="topSixesPlayer" class="mb-0"><span class="spinner"></span></p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body" style="background: linear-gradient(135deg, rgba(26,26,46,0.05) 0%, rgba(243,156,18,0.05) 100%);">
                        <i class="fas fa-crown" style="font-size: 2rem; color: #e74c3c;"></i>
                        <h5 class="mt-3" style="color: var(--text-dark);">Most Hundreds</h5>
                        <p id="topHundredsPlayer" class="mb-0"><span class="spinner"></span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Featured Leaderboards -->
        <div class="row">
            <div class="col-lg-6 mb-5">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-users"></i> Top Run Scorers</h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="topRunsLeaderboard">
                            <div class="text-center p-5"><span class="spinner"></span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-5">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-trophy"></i> Top Wicket Takers</h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="topWicketsLeaderboard">
                            <div class="text-center p-5"><span class="spinner"></span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Stats -->
        <div class="row">
            <div class="col-lg-6 mb-5">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-tachometer-alt"></i> Best Strike Rates</h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="strikeRateLeaderboard">
                            <div class="text-center p-5"><span class="spinner"></span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-5">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-calculator"></i> Best Averages</h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="averageLeaderboard">
                            <div class="text-center p-5"><span class="spinner"></span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="background: var(--primary-color); color: white; padding: 2rem 0; margin-top: 5rem; text-align: center;">
        <div class="container">
            <p style="margin: 0;">&copy; 2025 STATIFY - IPL Player Statistics Hub</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = '/api';

        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, "&amp;")
                       .replace(/</g, "&lt;")
                       .replace(/>/g, "&gt;")
                       .replace(/"/g, "&quot;")
                       .replace(/'/g, "&#039;");
        }

        function handleImageError(event) {
            event.target.onerror = null;
            event.target.src = 'https://placehold.co/50x50/1a1a2e/ffffff?text=Player';
        }

        async function loadLeaderboard(stat, containerId, limit = 10) {
            try {
                const response = await fetch(`${API_BASE}/leaderboards/${stat}`);
                const players = await response.json();
                const topPlayers = players.slice(0, limit);

                let html = '';
                topPlayers.forEach((player, index) => {
                    const statValue = player[stat] || 0;
                    html += `
                        <div class="leaderboard-item" onclick="viewPlayerProfile('${escapeHtml(player.id)}')">
                            <div class="leaderboard-rank">#${index + 1}</div>
                            <div class="leaderboard-player-info">
                                <img src="${escapeHtml(player.photo_url || '')}" alt="${escapeHtml(player.name)}" 
                                     class="player-photo" onerror="handleImageError(event)">
                                <div>
                                    <div class="player-name">${escapeHtml(player.name)}</div>
                                    <div class="player-team">${escapeHtml(player.team)}</div>
                                </div>
                            </div>
                            <div class="stat-value">${typeof statValue === 'number' && statValue % 1 !== 0 ? statValue.toFixed(2) : statValue}</div>
                        </div>
                    `;
                });

                document.getElementById(containerId).innerHTML = html;
            } catch (error) {
                console.error(`Error loading ${stat} leaderboard:`, error);
                document.getElementById(containerId).innerHTML = '<p class="text-danger text-center p-3">Failed to load data</p>';
            }
        }

        async function loadTopPlayer(stat, containerId) {
            try {
                const response = await fetch(`${API_BASE}/leaderboards/${stat}`);
                const players = await response.json();
                if (players.length > 0) {
                    const player = players[0];
                    const statValue = player[stat] || 0;
                    const displayValue = typeof statValue === 'number' && statValue % 1 !== 0 ? statValue.toFixed(2) : statValue;
                    document.getElementById(containerId).innerHTML = `
                        <div style="cursor: pointer;" onclick="viewPlayerProfile('${escapeHtml(player.id)}')">
                            <img src="${escapeHtml(player.photo_url || '')}" alt="${escapeHtml(player.name)}" 
                                 class="player-photo" onerror="handleImageError(event)" style="margin-bottom: 0.5rem;">
                            <div class="player-name">${escapeHtml(player.name)}</div>
                            <div class="player-team">${escapeHtml(player.team)}</div>
                            <div class="stat-value" style="margin-top: 0.5rem;">${displayValue}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error(`Error loading top ${stat} player:`, error);
            }
        }

        function viewPlayerProfile(playerId) {
            window.location.href = `/player-profile?id=${encodeURIComponent(playerId)}`;
        }

        // Load all leaderboards on page load
        window.addEventListener('load', () => {
            loadLeaderboard('runs', 'topRunsLeaderboard', 5);
            loadLeaderboard('wickets', 'topWicketsLeaderboard', 5);
            loadLeaderboard('strike_rate', 'strikeRateLeaderboard', 5);
            loadLeaderboard('average', 'averageLeaderboard', 5);
            
            loadTopPlayer('runs', 'topRunsPlayer');
            loadTopPlayer('wickets', 'topWicketsPlayer');
            loadTopPlayer('sixes', 'topSixesPlayer');
            loadTopPlayer('hundreds', 'topHundredsPlayer');
        });
    </script>
</body>
</html>